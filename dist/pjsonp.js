!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self)["promisify-jsonp"]=r()}(this,function(){"use strict";function r(e,r){for(var t=r&&r.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(t[n]=e[n]);return t}function g(e,r){o.apply(e,w(r)?r:[r])}function j(e,r,t,n,o,i,a,c,l,f,u,s,p){var d=e;if("function"==typeof a?d=a(r,d):d instanceof Date?d=f(d):"comma"===t&&w(d)&&(d=d.join(",")),null===d){if(n)return i&&!s?i(r,N.encoder,p):r;d=""}if("string"==typeof d||"number"==typeof d||"boolean"==typeof d||O.isBuffer(d))return i?[u(s?r:i(r,N.encoder,p))+"="+u(i(d,N.encoder,p))]:[u(r)+"="+u(String(d))];var y,m=[];if(void 0===d)return m;if(w(a))y=a;else{var v=Object.keys(d);y=c?v.sort(c):v}for(var h=0;h<y.length;++h){var b=y[h];o&&null===d[b]||(w(d)?g(m,j(d[b],"function"==typeof t?t(r,b):r,t,n,o,i,a,c,l,f,u,s,p)):g(m,j(d[b],r+(l?"."+b:"["+b+"]"),t,n,o,i,a,c,l,f,u,s,p)))}return m}function y(e,r){var t,n=e,o=function(e){if(!e)return N;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var r=e.charset||N.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=p.default;if(void 0!==e.format){if(!d.call(p.formatters,e.format))throw new TypeError("Unknown format option provided.");t=e.format}var n=p.formatters[t],o=N.filter;return"function"!=typeof e.filter&&!w(e.filter)||(o=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:N.addQueryPrefix,allowDots:void 0===e.allowDots?N.allowDots:!!e.allowDots,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:N.charsetSentinel,delimiter:void 0===e.delimiter?N.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:N.encode,encoder:"function"==typeof e.encoder?e.encoder:N.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:N.encodeValuesOnly,filter:o,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:N.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:N.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:N.strictNullHandling}}(r);"function"==typeof o.filter?n=(0,o.filter)("",n):w(o.filter)&&(t=o.filter);var i,a=[];if("object"!=typeof n||null===n)return"";i=r&&r.arrayFormat in m?r.arrayFormat:r&&"indices"in r?r.indices?"indices":"repeat":"indices";var c=m[i];t=t||Object.keys(n),o.sort&&t.sort(o.sort);for(var l=0;l<t.length;++l){var f=t[l];o.skipNulls&&null===n[f]||g(a,j(n[f],f,c,o.strictNullHandling,o.skipNulls,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.formatter,o.encodeValuesOnly,o.charset))}var u=a.join(o.delimiter),s=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&("iso-8859-1"===o.charset?s+="utf8=%26%2310003%3B&":s+="utf8=%E2%9C%93&"),0<u.length?s+u:""}var c=Object.prototype.hasOwnProperty,u=Array.isArray,l=function(){for(var e=[],r=0;r<256;++r)e.push("%"+((r<16?"0":"")+r.toString(16)).toUpperCase());return e}(),O={arrayToObject:r,assign:function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},combine:function(e,r){return[].concat(e,r)},compact:function(e){for(var r=[{obj:{o:e},prop:"o"}],t=[],n=0;n<r.length;++n)for(var o=r[n],i=o.obj[o.prop],a=Object.keys(i),c=0;c<a.length;++c){var l=a[c],f=i[l];"object"==typeof f&&null!==f&&-1===t.indexOf(f)&&(r.push({obj:i,prop:l}),t.push(f))}return function(e){for(;1<e.length;){var r=e.pop(),t=r.obj[r.prop];if(u(t)){for(var n=[],o=0;o<t.length;++o)void 0!==t[o]&&n.push(t[o]);r.obj[r.prop]=n}}}(r),e},decode:function(e,r,t){var n=e.replace(/\+/g," ");if("iso-8859-1"===t)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,r,t){if(0===e.length)return e;var n="string"==typeof e?e:String(e);if("iso-8859-1"===t)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var o="",i=0;i<n.length;++i){var a=n.charCodeAt(i);45===a||46===a||95===a||126===a||48<=a&&a<=57||65<=a&&a<=90||97<=a&&a<=122?o+=n.charAt(i):a<128?o+=l[a]:a<2048?o+=l[192|a>>6]+l[128|63&a]:a<55296||57344<=a?o+=l[224|a>>12]+l[128|a>>6&63]+l[128|63&a]:(i+=1,a=65536+((1023&a)<<10|1023&n.charCodeAt(i)),o+=l[240|a>>18]+l[128|a>>12&63]+l[128|a>>6&63]+l[128|63&a])}return o},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function n(o,i,a){if(!i)return o;if("object"!=typeof i){if(u(o))o.push(i);else{if(!o||"object"!=typeof o)return[o,i];(a&&(a.plainObjects||a.allowPrototypes)||!c.call(Object.prototype,i))&&(o[i]=!0)}return o}if(!o||"object"!=typeof o)return[o].concat(i);var e=o;return u(o)&&!u(i)&&(e=r(o,a)),u(o)&&u(i)?(i.forEach(function(e,r){if(c.call(o,r)){var t=o[r];t&&"object"==typeof t&&e&&"object"==typeof e?o[r]=n(t,e,a):o.push(e)}else o[r]=e}),o):Object.keys(i).reduce(function(e,r){var t=i[r];return c.call(e,r)?e[r]=n(e[r],t,a):e[r]=t,e},e)}},t=String.prototype.replace,n=/%20/g,p={default:"RFC3986",formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"},d=Object.prototype.hasOwnProperty,m={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,r){return e+"["+r+"]"},repeat:function(e){return e}},w=Array.isArray,o=Array.prototype.push,i=Date.prototype.toISOString,N={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:O.encode,encodeValuesOnly:!1,formatter:p.formatters[p.default],indices:!1,serializeDate:function(e){return i.call(e)},skipNulls:!1,strictNullHandling:!1},v=["anonymous","use-credentials",""];var a,h=(a="String",function(e){return Object.prototype.toString.call(e)==="[object "+a+"]"});function b(e){return h(e)&&0<e.length}function e(o,e){var t,i,r=b((e=e||{}).callbackNamePrefix)?e.callbackNamePrefix:"__jp",a=b(e.callbackName)?e.callbackName:function e(r,t){t=t||0;var n=r+ +new Date+"_"+t;return void 0===window[n]?(window[n]=null,n):e(r,t+1)}(r),n=b(e.callbackParamName)?e.callbackParamName:"callback",c=e.timeout||0,l=e.qsOpts||{},f=e.params||{},u=document.createElement("script");if(null!=e.crossOrigin){if(!(h(e.crossOrigin)&&-1<v.indexOf(e.crossOrigin)))return Promise.reject(new Error("Invalid crossOrigin value: "+e.crossOrigin));u.crossOrigin=e.crossOrigin}function s(){i&&clearTimeout(i),u.parentNode&&u.parentNode.removeChild(u),window[a]=void 0,t&&window.removeEventListener("error",t)}var p={};for(var d in p[n]=a,f)Object.prototype.hasOwnProperty.call(f,d)&&(p[d]=f[d]);return o=(o+=(~o.indexOf("?")?"&":"?")+y(p,l)).replace("?&","?"),u.src=o,new Promise(function(r,n){c&&(i=setTimeout(function(){s(),n(new Error("Timeout"))},c)),t=function(e){var r=e.filename,t=e.error;r===o&&(s(),n(t))},window.addEventListener("error",t),u.onerror=function(){s(),n(new Error("Script error"))},window[a]=function(e){s(),r(e)},function(e){var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(e,r):document.head.appendChild(e)}(u)})}var f=e,s=e;return f.default=s,f});
